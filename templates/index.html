{% extends "report.html" %}

{% block title %}QUAST{% endblock %}

{% block index-menu-li-class %}active{% endblock %}

{% block logo_class %}active{% endblock %}

{% block brand-link-class %}disabled{% endblock %}

{% block before_report_extra_head %}
    <script src="/static/ajaxuploader/fileuploader.js" xmlns="http://www.w3.org/1999/html"></script>
    <link href="/static/ajaxuploader/fileuploader.css" media="screen" rel="stylesheet" type="text/css"/>

    <link rel="stylesheet" href="/static/chosen/chosen.css" />
    <link rel="stylesheet" href="/static/evaluate.css" />
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap-responsive.min.css"/>
    <link rel="stylesheet" href="/static/index.css"/>
    <link rel="stylesheet" href="/static/reports.css"/>

    <script src="/static/chosen/chosen.jquery.js" type="text/javascript"></script>

    <script>
        $(function() {
            {% if highlight_last %}
                $('.highlighted_tr').hide().fadeIn('slow');
            {% endif %}
        });

        $(function() {
{#            $(".chzn-select").chosen();#}
            $(".chzn-select-deselect").chosen({
                allow_single_deselect:true,
                no_results_text: "No results matched",
            });
        });

        $(function() {
            $('#login_link').click(function() {
                $('#login_block').toggle('fast');
            });

            $('#authorize_submit').click(function() {
                var login_error = $('#login_error'),
                    login_msg   = $('#login_msg'),
                    email_input = $('#email_input');

                login_error.hide();
                login_msg.hide();

                var email = email_input.val();
                if (email == '') {
                    login_error.show();
                    email_input.focus();
                }
                $.ajax({
                    type: 'GET',
                    url: '{% url ask_password_link %}',
                    dataType: 'text',
                    data: 'email=' + email,

                }).done(function(msg) {
                    login_msg.html(msg).show();

                }).fail(function(xhr) {
                    var msg = 'Error. Try reloading page.';
                    if (xhr.status && xhr.status == 400) {
                        msg = xhr.responseText;
                    }
                    login_error.html(msg).show();
                    email_input.focus();
                });
                return false;
            });

            $('#is_authorized_email').click(function() {
{#                $('#is_authorized_div').toggle();#}
                var login_form = $('#login_form');

                login_form.toggle('fast');
                if (login_form.is(':visible')) {
                    $('#email_input').focus();
                }
            });
        });

        $(function() {
            $("#add-data-set-toggle-link").mouseenter(function() {
                $(this).find('.dotted-link').css('color', '#b33');
                $(this).find('.dotted-link').css('border-bottom', '1px dashed #ffcccc');
                $(this).find('.dotted-link').css('border-color', '1px dashed #ffcccc');
                $(this).find('.dotted-link').css('border-color', 'rgba(255, 0, 0, 0.2)');
            }).mouseleave(function() {
                $(this).find('.dotted-link').css('color', '#0c4f72');
                $(this).find('.dotted-link').css('border-bottom', '1px dashed #487b95');
                $(this).find('.dotted-link').css('border-color', '#487b95');
                $(this).find('.dotted-link').css('border-color', 'rgba(12, 79, 114, 0.2)');
            });

            {#        $("#id_is_created")[0].onclick = null;#}
            {#        $('#id_is_created').click(function(event) {#}
            {#            event.preventDefault();#}
            {#            var checkBox = $('#id_is_created');#}
            {#            checkBox.prop('checked', !checkBox.prop('checked'));#}
            {#            event.stopPropagation();#}
            {#        });#}

            $('#add-data-set-toggle-link').click(function(event) {
                event.preventDefault();

                var checkBox = $('#id_is_created');
                var addDataSet = $('#add-data_set');

                addDataSet.stop().slideToggle('fast', function() {
                    $('#id_name_created').focus();

                    if (addDataSet.is(':visible')) {
                        checkBox.prop('checked', true);
                    } else {
                        checkBox.prop('checked', false);
                    }
                });
            });
        });

        var submitted = false;

        var allComplete = false;
        var uploaders = [];

        var initContigsFiles = false;

        $(window).unload(function() {
            if (!submitted) {
                $.ajax({
                    url: '{% url ajax_delete_session %}',
                    type: 'GET',
                    data: { reportId: '{{ report_id }}' },
                    async: false,
                });
            }
        });

        $(function() {
            var parameters = [{
                action: '{% url contigs_ajax_upload %}',
                removeLink: '{% url contigs_ajax_remove %}',
                initializeUploadsLink: '{% url contigs_ajax_initialize_uploads %}',
                elementId: '#contigs-uploader',
                multiple: true,
                buttonClass: 'btn',
                buttonTabIndex: 1,
                btnText: 'Add files',
                areaText: 'drop files here',
                areaClass: 'upload-drop-area',
                uploaded: '{% for fname in contigs_fnames %}<li>{{ fname }} &nbsp;' +
                    // '<a class="dotted-link" style="font-size: 0.8em;" href="#">Remove</a>' +
                    '</li>{% endfor %}',
            },];

            var evaluateButton = $('#evaluate-button');

            for (var i = 0; i < parameters.length; i++) {
                uploaders.push(new qq.FileUploader({
                    action: parameters[i].action,
                    removeLink: parameters[i].removeLink,
                    initializeUploadsLink: parameters[i].initializeUploadsLink,
                    element: $(parameters[i].elementId)[0],
                    multiple: parameters[i].multiple,
                    maxConnections: 1,
                    buttonClass: parameters[i].buttonClass,
                    buttonTabIndex: parameters[i].buttonTabIndex,
                    reportId: "{{ report_id }}",
                    debug: {% if debug %}true{% else %}false{% endif %},
                    onSubmit: function(id, fileName) {
                        evaluateButton.prop('disabled', false);
                        evaluateButton.removeClass('disabled');
                        var areaText = $('.area-text');
                        areaText.css('display', 'none');
                        allComplete = false;
                    },
                    onComplete: function(id, fileName, responseJSON) {
                        if (responseJSON.success) {
{#                            $('#evaluate-button').prop('disabled', false);#}
{#                            $('#evaluate-button').removeClass('disabled');#}
                        }
                    },
                    onAllComplete: function(uploads) {
                        if (uploads.length > 0) {
{#                            $('#evaluate-button').prop('disabled', false);#}
{#                            $('#evaluate-button').removeClass('disabled');#}
                            var areaText = $('.area-text');
                            areaText.css('display', 'none');
                            allComplete = true;
                        }
                        // uploads is an array of maps
                        // the maps look like this: {file: FileObject, response: JSONServerResponse}
                    },
                    onRemove: function() {
                        var number_of_files = -1;
                        $('.qq-upload-file').each(function(index) {
                            number_of_files++;
                        });

                        if (number_of_files <= 0) {
                            evaluateButton.prop('disabled', true);
                            evaluateButton.addClass('disabled');
                            var areaText = $('.area-text');
                            areaText.css('display', 'block');
                        }
                    },
                    onInitFiles: function(files){
                        var areaText = $('.area-text');
                        if (!files || files.length == 0) {
                            evaluateButton.prop('disabled', true);
                            evaluateButton.addClass('disabled');
                            areaText.css('display', 'block');
                        } else {
                            evaluateButton.prop('disabled', false);
                            evaluateButton.removeClass('disabled');
                            areaText.css('display', 'none');
                            allComplete = true;
                        }
                    },
                    params: {
                        'csrf_token': '{{ csrf_token }}',
                        'csrf_name': 'csrfmiddlewaretoken',
                        'csrf_xname': 'X-CSRFToken',
                    },
                    messages: {
                    },
                    template:
                            '<div class="qq-uploader">' +
                                '<span class="upload-button btn">' + parameters[i].btnText + '</span>' +
                                '<div>' +
                                    '<div class="' + parameters[i].areaClass + '">' +
                                        '<div class="upload-list-div">' +
                                            '<ul class="upload-list"></ul>' +
                                        '</div>' +
                                        '<div class="area-text" style="margin-top: 55px; margin-left: 90px; opacity: 0.5;">' + parameters[i].areaText + '</div>' +
                                    '</div>' +
                                '</div>' +
                            '</div>',
                    fileTemplate:
                            '<li>' +
                            '<span class="qq-upload-file"></span>' +
                            '<span class="qq-upload-spinner"></span>' +
                            '<span class="qq-upload-size"></span>' +
                            '<a class="dotted-link qq-upload-cancel" href="#">cancel</a>' +
    {#                        '<a class="dotted-link qq-upload-remove" href="#" style="opacity: 0.5;"><img src="/static/pics/delete_icon.png" height=7></a>' +#}
                            '<a class="dotted-link qq-upload-remove" href="#">remove</a>' +
                            '<span class="qq-upload-failed-text">Failed</span>' +
                         // '<a class="dotted-link" style="font-size: 0.8em;" href="#">Remove</a>' +
                            '</li>',
                    classes: {
                        // used to get elements from templates
                        button: 'upload-button',
                        drop: parameters[i].areaClass,
                        dropActive: 'upload-drop-area-active',
                        list: 'upload-list',

                        file: 'qq-upload-file',
                        spinner: 'qq-upload-spinner',
                        size: 'qq-upload-size',
                        cancel: 'qq-upload-cancel',
                        remove: 'qq-upload-remove',

                        // added to list item when upload completes
                        // used in css to hide progress spinner
                        success: 'qq-upload-success',
                        fail: 'qq-upload-fail'
                    }
                }));
            }
        });

        function submitDataSetForm(dataSetForm) {
            document.eval_form.elements['report_id'].value = '{{ report_id }}';

            var evaluateButton = $('#evaluate-button');
            evaluateButton.prop('disabled', true);
            evaluateButton.addClass('disabled');

            var submitMessage = $('#submit_message');

            var check = function() {
                if (allComplete) {
                    if ($('.qq-upload-fail')[0]) {
                        $('#submit_message').html('Some loadings were failed ' +
                                'and the sending was stopped. You may want to' +
                                ' try again after reloading the page. If that doesn\'t' +
                                ' help, please, report us: <a href="mailto:quast.support' +
                                '@bioinf.spbau.ru">quast.support@bioinf.spbau.ru</a>').show();
                        evaluateButton.prop('disabled', false);
                        evaluateButton.removeClass('disabled');
                    } else {
                        var fnames = "";
                        $('.qq-upload-file').each(function(index, element) {
                            fnames += element.innerText;
                            fnames += '\n'
                        });
                        submitted = true;
                        document.eval_form.elements['contigs'].value = fnames;
                        document.eval_form.submit();
                    }
                } else {
                    submitMessage.html('Waiting for contigs to finish loading...').show();
                    setTimeout(check, 500); // check again in a moment
                }
            };
            check();
        }

    //        $('#add-data_set-wrapper').click(
    //            $('#add-data-set-toggle-link').
    //        );


{#    function showHideAddDataset() {#}
    {#            $('#add-data-set-toggle-link>a').#}
{#        if ($('#add-data_set').is(':visible')) {#}
{#            $('#add-data_set').hide('fast');#}
{#            $('#dataset-name-select-input').prop('disabled', false);#}
{#            set_selected();#}
{#        } else {#}
{#            $('#add-data_set').show('fast');#}
{#            $('#dataset-name-select-input').prop('disabled', true);#}
{#            set_created();#}
{#        }#}
{#    }#}

    </script>
{% endblock %}

{% block after_report_extra_head %}
    <script type="text/javascript">
        $(function() {
            $('.full-report').css('display', 'none');

            {#        function scroll(event) {#}
            {#            $('.full-report').fadeToggle('fast');#}
            {#            event.preventDefault();#}
            {#            $('html,body').animate({scrollTop:$(this.hash).offset().top}, 500);#}
            {#        }#}

            $('#report_example_anchor').click(function(event){
                var fullReport = $('.full-report');
                var wasHidden = (fullReport.css('display') == 'none');
                if (wasHidden) {
                    fullReport.stop().fadeToggle('fast');
                }
                event.preventDefault();
                $('html,body').animate({scrollTop:$(this.hash).offset().top + 20}, 500);
            });

            $("#report_example_toggle").click(function(event) {
                var fullReport = $('.full-report');
                var wasHidden = (fullReport.css('display') == 'none');
                fullReport.stop().fadeToggle('fast');
                if (wasHidden) {
                    event.preventDefault();
                    $('html,body').animate({scrollTop:$(this.hash).offset().top + 20}, 500);
                }
            });
        });

        {##}
        {#        function set_selected() {#}
        {#            $('#id_created_or_selected').prop('value', 'selected');#}
        {#        }#}
        {##}
        {#        function set_created() {#}
        {#            $('#id_created_or_selected').prop('value', 'created');#}
        {#        }#}

        {#        $('#another-data-set-input').click(checkAnotherDataSet);#}

        {#        function checkAnotherDataSet() {#}
        {#            var nameSelectInput = $('#id_created'1);#}
        {#            var idCreatedOrSelected = $('id_created_or_selected');#}

        {#            var addDataSet = $('#add-data_set');#}
        {#            if (addDataSet.is(':visible')) { //TODO: CHECK IT!!!!! Maybe needed to check display:none#}
        {#                nameSelectInput.prop('disabled', false);#}
        {#                idCreatedOrSelected.prop('value', 'selected');#}
        {#            } else {#}
        {#                nameSelectInput.prop('disabled', true);#}
        {#                idCreatedOrSelected.prop('value', 'created');#}
        {#            }#}
        {#        }#}
    </script>
{% endblock %}

{% block extra_content %}
    <div id="index" style="margin-top: -3px;">
        <div class="blue-panel">
        <table class="layout-table">
            <tr>
                <td class="layout-table-td layout-table-fst-td" style="vertical-align: top; padding-right: 20px;">
                    <div style=''>
{#                        <div class='row-fluid'>#}
                        <table>
                            <tr>
                            <td style="vertical-align: top; width: 50%; padding-right: 30px;">
                                <div class="" style="padding-right: 10px;">
                                    <p style="margin-top: 11px; font-weight: bold;"><span class='smallcapitals'>QUAST</span> evaluates genome assemblies by computing various metrics</p>
                                    <ul class="list">
                                        <li><span class='define' key='N50'><span class='smallcapitals'>N</span>50</span>, length of the shortest contig from all that cover 50% of all assembly</li>
                                        <li><span class='define' key='NG50'><span class='smallcapitals'>NG</span>50</span>, where the reference genome is being covered</li>
                                        <li><span class='define' key='NA50'><span class='smallcapitals'>NA</span>50</span> and <span class='define' key='NGA50'><span class='smallcapitals'>NGA</span>50</span>, where aligned blocks instead of contigs are taken</li>
                                        <li>misassemblies, misassembled and unaligned contigs or contigs bases</li>
                                        <li><span class='define' key='Genes covered'>genes</span> and <span class='define' key='Operons covered'>operons</span> covered</li>
                                        <li>and other metrics</li>
                                    </ul>
                                </div>
                            </td>
                            <td style="vertical-align: top;">
                                <div class="" style="padding-right: 10px;">
                                    <p style="font-weight: bold;">Builds convenient plots for different metrics</p>
                                    <ul class="list">
                                        <li>cumulative contigs length</li>
                                        <li>all kinds of N-metrics</li>
                                        <li>genes and operons covered</li>
                                        <li><span class='smallcapitals'>GC</span> content</li>
                                    </ul>
                                    <a class="dotted-link js" id="report_example_anchor" href="#reportexample">Report example</a>
                                    <br>
                                    <br>
                                </div>
                            <div style="clear: both;"></div>
                            </td>
                            </tr>
                        </table>
{#                        </div>#}
                    </div>
                </td>

                <td class="layout-table-td layout-table-snd-td" style="vertical-align: top;">
                    <div class="row-fluid">
                        <div class="span12" style='max-width: 300px; margin-top: 0px; margin-bottom: 30px;'>
                {#        <div style="float: left; max-width: 300px; margin-top: -10px">#}
                            <p>
                                <a href="https://sourceforge.net/projects/quast/files/" class='btn btn-primary btn-large' style='text-align: left; margin-left: 1px;'>Download source code</a>
                            </p>
                            <p>
                                For installation details and usage instructions,
                                please read <a href="manual.html">the manual</a>.<br>
                            </p>
                            <p style="margin-top: 30px;"><i>
                                We will be thankful if you help us make <span class='smallcapitals'>QUAST</span> better by sending your comments, bug reports, and suggestions
                                to&nbsp;<a href="mailto:quast.support@bioinf.spbau.ru">quast.support@bioinf.spbau.ru</a>.
                            </i></p>
                        </div>

{#                        <div class='span6' style="max-width: 300px; padding-left: 40px; padding-right: 30px;">#}
{#                            <p><b>7 Oct 2012</b><br> <span style="margin-left: -0.4em;">”</span>QUAST: Quality Assessment for Genome Assemblies” paper was submitted to <a href="http://bioinformatics.oxfordjournals.org/">Bioinformatics</a>.</p>#}
{#                        </div>#}
                    </div>
                </td>
            </tr>
        </table>
        </div>
    </div>

    <div style="clear: both;"></div>

    <div style="height: 30px;">
    </div>

    <div id="quality_assessment">
{#        <p>#}
{#            <a style="font-size: 2em;" href="evaluate">Quality Assessment</a>#}
{#        </p>#}

        <noscript>
            <div><br>
                Unfortunately, <span style="font-weight: bold">JavaScript</span> in your browser <span style="font-weight: bold">is disabled</span> or is not supported.</br>
                We need JavaScript to process data and build reports.
            </div>
        </noscript>

        <table class="layout-table">
            <tr>
            <td class="layout-table-td layout-table-fst-td">
                <h2 style='font-size: 1.8em; font-weight: normal;'>Quality Assessment</h2>
                <div id='form-wrapper'>
                    <table class='form-layout-table'>
                        <tr>
                            <td class='form-layout-td' style="padding-top: 3px;">
                                <div style="padding-top: 13px;">Contigs</div>
                            </td>

                            <td class='form-layout-td'>
                                <div id="contigs-uploader" class="uploader-div" style="margin-bottom: 10px; height: 175px;"></div><div style="clear: both"></div>
                            </td>
                        </tr>
                    </table>
                    <form enctype="multipart/form-data" name='eval_form' id="eval_form" action="/" method="POST">{% csrf_token %}
                        <div style="display: none;">
                            {{ data_set_form.contigs }}
                        </div>

                        <div style="display: none;">
                            {{ data_set_form.report_id }}
                        </div>

                        <label for="id_min_contig" tabindex="2">{% comment %}@declare id="id_min_contig"{% endcomment %}
                            Skip contigs shorter than
                            <span style='font-size: 8px;'>{{ data_set_form.min_contig }} </span>bp<br>
                            {{ data_set_form.min_contig.errors }}
                        </label>

                        <br>

                        <table class='form-layout-table'>
                            <tr>
                                <td class='form-layout-td' style="padding-top: 0px;">
                                    <div style="padding-top: 13px;">Genome</div>
                                </td>

                                <td class='form-layout-td'>{% comment %}@declare id="id_name_selected"{% endcomment %}
                                    <label for="id_name_selected">
                                        {{ data_set_form.name_selected }}
                                    </label>
                                    <div style="display: none">
                                        {{ data_set_form.name_selected.errors }}
                                    </div>
{#                                    <div id="unknown_data_set">#}
{#                                        <label for="unknown_data_set_input">#}
{#                                            <input type="checkbox" tabindex="4" id="unknown_data_set_input"/>#}
{#                                            Unknown data set#}
{#                                        </label>#}
{#                                    </div>#}
                                    <div style="height: 2px;"></div>
                                </td>
                            </tr>
                            <tr>
                                <td class='form-layout-td' style="padding-top: 9px;"></td>

                                <td class='form-layout-td'>
                                    <div id="add-data-set-toggle-link" style="margin-left: -15px; padding-left: 15px;">
                                        <div style="margin-left: 0px;">
                                            <label for="id_is_created">
                                                <input type="checkbox" tabindex="4" class='dotted-link' name="is_created" id="id_is_created"/>
    {#                                                {{ data_set_form.created_or_selected }}#}
                                                <a class='dotted-link'>Another genome</a>
                                            </label>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
    {#                                    <select name="name_selected" class="chzn-select" id="dataset-select" style="width:350px;" tabindex="2" onchange="datasetSelectOnchange()">#}
    {#                                            {% for dataset in datasets %}#}
    {#                                            <option value="{{ dataset.name }}">{{ dataset.name }}</option>#}
    {#                                            {% endfor %}#}
    {#                                            <option value="custom-dataset">Add dataset...</option>#}
    {#                                        </select>#}
    {#                                        <div style="clear: both"></div>#}
                        <div id="add-data_set" style="display: none;">
    {#                                                {% comment %}@declare id="id_name_created "{% endcomment %}#}
    {#                                                <label for='id_name_created'>Dataset name#}
    {#                                                {{ data_set_form.name_created }}</label>#}
    {#                                                {% comment %}@declare id="id_reference"{% endcomment %}#}
    {#                                                <label for='id_reference'>Reference<br/>#}
    {#                                                {{ data_set_form.reference }}</label>#}
    {#                                                {% comment %}@declare id="id_genes"{% endcomment %}#}
    {#                                                <label for='id_genes'>Genes<br/>#}
    {#                                                {{ data_set_form.genes }}</label>#}
    {#                                                {% comment %}@declare id="id_operons"{% endcomment %}#}
    {#                                                <label for='id_operons'>Operons<br/>#}
    {#                                                {{ data_set_form.operons }}</label>#}
                            <table class='form-layout-table'>
                                <tr>{% comment %}@declare id="id_name_created"{% endcomment %}
                                    <td class='form-layout-td'><label for='id_name_created'>Name</label></td>
                                    <td class='form-layout-td'>{{ data_set_form.name_created }}<span style='font-size: 8px;'>&nbsp;</span><br>
                                        <div class="comment_to_field">We will remember the data set with this name, if you fill in this field.</div>
                                        {{ data_set_form.name_created.errors }}
                                        <br>
                                    </td>
                                </tr>
                                <tr>{% comment %}@declare id="id_reference"{% endcomment %}
                                    <td class='form-layout-td'><label for='id_reference'>Reference</label></td>
                                    <td class='form-layout-td'>{{ data_set_form.reference }}
                                        {{ data_set_form.reference.errors }}
                                        <div class="comment_to_field">FASTA file with the reference genome sequence.
                                        </div><br>
                                    </td>
                                </tr>
                                <tr>{% comment %}@declare id="id_genes"{% endcomment %}
                                    <td class='form-layout-td'><label for='id_genes'>Genes</label></td>
                                    <td class='form-layout-td'>{{ data_set_form.genes }}
                                        {{ data_set_form.genes.errors }}
                                        <div class="comment_to_field">See <a href="http://quast.bioinf.spbau.ru/manual.html#sec2.2">manual</a> for file formats.
                                        </div><br>
                                    </td>
                                </tr>
                                <tr>{% comment %}@declare id="id_operons"{% endcomment %}
                                    <td class='form-layout-td'><label for='id_operons'>Operons</label></td>
                                    <td class='form-layout-td'>{{ data_set_form.operons }}
                                        {{ data_set_form.operons.errors }}
                                        <div class="comment_to_field">See <a href="http://quast.bioinf.spbau.ru/manual.html#sec2.2">manual</a> for file formats.
                                        </div><br>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <br>

                        <table class='form-layout-table'>
                            <tr>{% comment %}@declare id="id_caption"{% endcomment %}
                                <td class='form-layout-td'><label for='id_caption'>Caption</label></td>
                                <td class='form-layout-td'>{{ data_set_form.caption }}
                                    <div class="comment_to_field">Will appear in the report.
                                    </div><br>
                                </td>
                            </tr>
{#                            <tr>{% comment %}@declare id="id_comment"{% endcomment %}#}
{#                                <td class='form-layout-td'><label for='id_comment'>Comment</label></td>#}
{#                                <td class='form-layout-td'>{{ data_set_form.comment }}#}
{#                                    <div class="comment_to_field">Will appear in the report.#}
{#                                    </div><br>#}
{#                                </td>#}
{#                            </tr>#}
{#                            <tr>{% comment %}@declare id="id_email"{% endcomment %}#}
{#                                <td class='form-layout-td'><label for='id_email'>Email</label></td>#}
{#                                <td class='form-layout-td'>{{ data_set_form.email }}#}
{#                                    <br>#}
{#                                    <div class="comment_to_field">#}
{#                                        If you provide an email address, we will notify you when the report is ready.<br>#}
{#                                        <div style="height: 5px;"></div>#}
{#                                        We will also contact you if there is a problem in running the assessment.<br>#}
{#                                        <div style="height: 5px;"></div>#}
{#                                        If you do not receive a notification, please check your junk mail folder.<br>#}
{#                                    </div>#}
{#                                    <br>#}
{#                                    <br>#}
{#                                </td>#}
{#                            </tr>#}
                        </table>

                        <div class="submit-wrapper">
                            <div id='errors-wrapper' style="display: block">
                                {{ data_set_form.non_field_errors }}
                            </div>

                            <div id="evaluate-button-wrapper">
                                <input id='evaluate-button'
                                       class="btn btn-large btn-inverse"
                                       name="submitButton"
                                       tabindex="12"
                                       type="submit"
                                       value="Evaluate"
                                       onclick="submitDataSetForm('eval_form'); return false;">
                                <div style="visibility: {% if highlight_last %}visible{% else %}hidden{% endif %};
                                            float: right;"
                                     id="{{ report_link }}">
                                    <p>
{#                                        <a href="{{ latest_report_link}}">Report</a>#}
                                    </p>
                                </div>
                                <div id='submit_message' style="display: none; color: #2c2c2c; padding-top: 8px;">
                                </div>
                            </div>

                            <div style="clear: both"></div>
                        </div>
                    </form>
                </div>
            </td>
            <td class="layout-table-td layout-table-snd-td">
                <div id="latest_reports" style="margin-left: 0px; margin-top: 10px;">
{#                    <div style="margin-top: 25px; margin-left: -2px; margin-bottom: 5px;">#}
{#                        <a class="dotted-link js" id="login_link">Log in</a>#}
{#                    </div>#}

                    <div id="login_block" style="display: block; margin-top: 25px; margin-bottom: 30px;">
                        <div id="is_authorized_div"
                             style="display: {% if not is_authorized %}none{% else %}block{% endif %};
                                     margin-left: -2px; margin-bottom: 5px;">
                            <a class="dotted-link js" id="is_authorized_email">{{ email }}</a>
                        </div>

                        <form id="login_form"
                              style="display: {% if is_authorized %}none{% else %}block{% endif %};
                                     margin-bottom: 20px;">

                            <label for="email_input" style="margin-left: -41px;">Email:</label>
                            <input type="text" name="email" id="email_input" style="width: 250px;">
                            <input type="submit" value="Log in" id="authorize_submit">

                            <div id="login_error" style="color: FireBrick; display: none; margin-left: -2px; margin-top: 2px;"></div>
                            <div id="login_msg" style="color: #259217; display: none; margin-left: -2px; margin-top: 2px;"></div>

                            <div class="comment_to_field"
                                 style="display: {% if is_authorized %}none{% else %}block{% endif %};
                                        margin-left: -2px; margin-top: 4px; width: 270px;">
                                Your reports and genomes will be associated with this address.<br>
                                <div style="height: 5px;"></div>
                                We will also notify you when a report is ready and contact you if there is a problem in running the assessment.<br>
                                <div style="height: 5px;"></div>
                                If you do not receive a notification, please check your junk mail folder.<br>
                            </div>
                        </form>
                    </div>

                    {% if quast_sessions|length > 0 %}
                    <table style="margin-left: -5px;">
                        <tr>
{#                            <td class='form-layout-td' style="padding: 0px; padding-right: 0px; vertical-align: top;">#}
{#                                <h3 style="margin-top: 3px; ">Reports&nbsp;&nbsp;</h3>#}
{#                            </td>#}
{#                            <div style="float: left; margin: -12px 25px 0 0;">#}
{##}
{#                            </div>#}
                            <td>
                                <table id='table_reports' style="margin-top: -5px;">
                                    {% if quast_sessions %}
                                    <tr class='reports_header_tr'>
                                        <td>
                                            <span style="font-size: 1.2em;"><a href="/reports/">Reports</a></span>
                                        </td>
                                        <td>
                                            Contigs
                                        </td>
                                        <td>
                                            Genome
                                        </td>
                                    </tr>

                                    <tr class='reports_line_tr'>
                                        <td colspan="3" style="border-top: 1px solid #bbb;"></td>
                                    </tr>
                                    {% endif %}

                                    {% for quast_session in quast_sessions %}
                                    <tr{% if highlight_last and forloop.counter == 1 %} class='highlighted_tr' style="display: none;"
                                        {% else %} class=''{% endif %}>
                                        <td class='caption_td wrapword' style="width: 170px;">
                                            <div>
                                                <div>
{#                                                    <div style="width: 40px; float: left;">#}
{#                                                    </div>#}
                                                    <a href="{{ quast_session.report_link }}">
                                                        {% if quast_session.caption %}
                                                            {{ quast_session.caption|truncatewords:20|truncatechars:200 }}
                                                        {% else %}
                                                            {{ quast_session.date|date:'d M Y, H:i' }}
                                                        {% endif %}
                                                    </a>
                                                </div>

                                                {% if quast_session.caption %}
                                                    <div style="margin-top: 3px;">
                                                        {{ quast_session.date|date:'d M Y, H:i' }}
                                                    </div>
                                                {% endif %}

                                                {% if quast_session.state == 'PENDING' %}
                                                    <div style="margin-top: 3px;"><span class="state_pending">in progress</span></div>
                                                {% elif quast_session.state == 'FAILURE' %}
                                                    <div style="margin-top: 3px;"><span class="state_failure">failed</span></div>
                                                {% endif %}
                                            </div>

                                        </td>
                                        <td class='contigs_td wrapword'>
                                            {% if quast_session.contigs %}
                                                <div>
                                                    {#                                                            <div style="clear: both"></div>#}
                                                    {#                                                            <div style="float: left; width: 70px;">Contigs:</div>#}
                                                    {#                                                            <div style="margin-left: 70px;">#}
                                                    {% for contig in quast_session.contigs %}
                                                        <div style="margin-bottom: 5px;">{{ contig }}</div>
                                                    {% endfor %}
                                                    {#                                                            </div>#}
                                                </div>
                                            {% endif %}
                                        </td>
                                        <td class='genome_td wrapword'>
                                                {% if quast_session.data_set_name %}
                                                    <div style="margin-bottom: 5px;">
{#                                                            <div style="float: left; width: 70px;">Genome:</div>#}
{#                                                            <div style="margin-left: 70px;">#}
                                                            {{ quast_session.data_set_name|truncatechars:100 }}
{#                                                            </div>#}
{#                                                            <div style="clear: both"></div>#}
                                                    </div>
                                                {% endif %}
                                        </td>
                                    </tr>
{#                                        <td>#}
{#                                            {% if quast_session.with_data_set %}<span>{{ quast_session.dataset_name }}</span>{% endif %}#}
{#                                        </td>#}
{#                                        </td>#}
{#                                        <td>#}
{#                                            {% if quast_session.caption %}{{ quast_session.caption|truncatechars:50 }}{% endif %}#}
{#                                        </td>#}
                                    {% endfor %}
{#                                    {% if show_more_link %}#}
{#                                        <tr><td></td></tr>#}
{#                                        <tr><td><a href="/reports/">Older reports</a></td></tr>#}
{#                                    {% endif %}#}
{#                                    <tr>#}
{#                                        <td>&nbsp;</td>#}
{#                                    </tr>#}

                                    <div style="clear: both;"></div>
                                </table>
                            </td>
                        </tr>
                    </table>

                    <script>
                        function set_report_table_widths() {
                            var table_reports = $('#table_reports');
                            var table_width = table_reports.width();
                            var rest_columns_width = (table_width-200) / 2;
                            var value = rest_columns_width + 'px';
                            $('.genome_td').css('width', value);
                            $('.contigs_td').css('width', value);
                        }
{#                        $.event.add(window, "load", set_report_table_widths);#}
{#                        $.event.add(window, "resize", set_report_table_widths);#}
                    </script>

                    {% endif %}
                    <div style="clear: both;"></div>
                </div>
            </td>
            </tr>
        </table>

        <div style="clear: both;"></div>

        <script type="text/javascript">
{#            set_selected();#}
        </script>

        <br><br><br>

         {# anchor #}
        <span id="reportexample"></span>
        <h2><a class='dotted-link js' id='report_example_toggle' href="#reportexample" tabindex="10">Report Example</a></h2>
        <p class='full-report'>Comparison of 4 different E. coli assemblies with one data set.</p>
        <div id="extended_link" class='full-report'></div>
    </div>

{#    <p style="">You can check out a sample report:</p>#}
{% endblock %}



